<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Convite Coconista ‚Äî PDF em 1 p√°gina</title>

<!-- estilos visuais da p√°gina -->
<style>
  :root{
    --a4-w-mm: 210mm;
    --a4-h-mm: 297mm;
  }
  body{
    font-family: "Trebuchet MS", Arial, sans-serif;
    background: linear-gradient(to bottom, #f4e1c1, #d9b382);
    margin: 0;
    padding: 20px;
    color: #3b2f2f;
    text-align: center;
  }

  header{
    background: linear-gradient(to right, #7c4c2f, #5b3821);
    color: #f7e7c0;
    padding: 22px;
    border-bottom: 5px solid #d4a056;
    border-radius: 10px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  }

  .page-wrap{
    max-width: 900px;
    margin: 18px auto;
  }

  section.card{
    margin: 16px auto;
    padding: 14px;
    background-color: #fffbe9;
    border-radius: 12px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.12);
    border: 3px solid #d4a056;
    max-width: 600px;
  }

  h2{
    color:#7c4c2f;
    margin:8px 0;
  }
  ul{ list-style:none; padding-left:0; text-align:left; }
  ul li::before{ content: "ü•• "; margin-right:6px; }

  /* bot√£o */
  .btn{
    display:inline-block;
    background:#d4a056;
    color:#fff;
    padding:12px 22px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:700;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
    margin: 12px 6px;
  }
  .btn:hover{ background:#b88944; }

  /* ------------ √ÅREA QUE SER√Å USADA PARA GERAR O PDF (A4) ------------ */
  /* colocamos essa √°rea fora da tela (assim n√£o fica vis√≠vel), mas renderiz√°vel */
  #pdfArea{
    position: absolute;
    left: -9999px;   /* fora da tela, mas vis√≠vel para render */
    top: 0;
    width: var(--a4-w-mm);
    height: var(--a4-h-mm);
    box-sizing: border-box;
    padding: 15mm;
    background: linear-gradient(#fffdf3, #fffaf0);
    border: 8px double #d4a056;
    border-radius: 12px;
    color: #3b2f2f;
    overflow: hidden; /* garantir sem overflow */
    display: block;
  }
  /* Estilo interno do PDF (ajustado para caber numa p√°gina A4) */
  .pdf-header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:10px;
  }
  .selo{
    width:72px;
    height:72px;
    border-radius:50%;
    background: linear-gradient(135deg,#f3dba3,#d4a056);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:34px;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
  }
  .pdf-title{
    text-align:left;
  }
  .pdf-title h1{ margin:0; font-size:22px; color:#7c4c2f; }
  .pdf-title p{ margin:4px 0 0 0; font-size:12px; color:#533f36; }

  .pdf-section{ margin:8px 0; font-size:12.5px; text-align:left; }
  .pdf-section h2{ font-size:14px; margin:0 0 6px 0; color:#7c4c2f; border-bottom:1px dashed #d4a056; padding-bottom:4px; }
  .pdf-footer{
    position:absolute;
    bottom:18mm;
    left:15mm;
    right:15mm;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:11px;
    color:#533f36;
  }

  /* QR code dentro do PDF */
  #pdf-qr{ width:110px; height:110px; border:6px solid #fff; background:#fff; padding:6px; box-shadow:0 4px 8px rgba(0,0,0,0.12); }

  /* se quiser que o iframe continue na p√°gina normal (para usu√°rio ver) */
  .maps-frame{ width:100%; height:320px; border-radius:10px; border:0; }
</style>
</head>
<body>

<header>
  <h1>ü•• Convite para o Sagrado Culto Coconista</h1>
  <p>Voc√™ foi escolhido para celebrar o dia do Deus Coco!</p>
</header>

<div class="page-wrap">
  <!-- Conte√∫do normal vis√≠vel na web -->
  <section class="card">
    <h2>üìÖ Data e Hora</h2>
    <p>17 de Agosto de 2025 ‚Äî 11:00</p>
  </section>

  <section class="card">
    <h2>üìú Regras Sagradas</h2>
    <ul>
      <li>Confirmar presen√ßa at√© 15 de Agosto</li>
      <li>Manter a casa organizada como templo</li>
      <li>N√£o perturbar os animais sagrados</li>
      <li>Respeitar o t√©rmino √†s 17:00</li>
    </ul>
  </section>

  <section class="card">
    <h2>üéÅ Oferendas</h2>
    <ul>
      <li>Roupa confort√°vel</li>
      <li>Bebida para consumo pr√≥prio</li>
      <li>Traje coconista para o culto</li>
    </ul>
  </section>

  <section class="card">
    <h2>üìç Localiza√ß√£o (visual no site)</h2>
    <p>Gama ‚Äî Bras√≠lia, DF</p>
    <!-- mantemos o iframe apenas para visualiza√ß√£o na p√°gina; N√ÉO ser√° capturado pelo PDF -->
    <iframe class="maps-frame"
      src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d1917.836535729784!2d-48.2046674!3d-15.9784404!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x935bd72619f7b693%3A0x8b61fbf6b3794ceb!2sGama%2C%20Bras%C3%ADlia%20-%20DF!5e0!3m2!1spt-BR!2sbr!4v1755018874830!5m2!1spt-BR!2sbr"
      loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen></iframe>
  </section>

  <div style="text-align:center;">
    <button class="btn" id="gerarBtn">üìÑ Baixar PDF Sagrado (1 p√°gina)</button>
    <button class="btn" id="baixarSimples">üîó Baixar vers√£o simples (sem QR)</button>
  </div>
</div>

<!-- ------------ AREA A4 PARA GERAR O PDF (N√ÉO VISIBLE NA TELA) ------------ -->
<div id="pdfArea" aria-hidden="true">
  <div class="pdf-header">
    <div class="selo">ü••</div>
    <div class="pdf-title">
      <h1>Sagrado Convite Coconista</h1>
      <p>17 de Agosto de 2025 ‚Äî 11:00 | Fim √†s 17:00</p>
    </div>
  </div>

  <div class="pdf-section">
    <h2>Regras Sagradas</h2>
    <ul>
      <li>Confirmar presen√ßa at√© 15 de Agosto</li>
      <li>Manter a casa organizada como templo</li>
      <li>N√£o perturbar os animais sagrados</li>
      <li>Respeitar o t√©rmino √†s 17:00</li>
    </ul>
  </div>

  <div class="pdf-section">
    <h2>Oferendas</h2>
    <ul>
      <li>Roupa confort√°vel</li>
      <li>Bebida para consumo pr√≥prio</li>
      <li>Traje coconista</li>
    </ul>
  </div>

  <div class="pdf-section" style="display:flex;align-items:center;justify-content:space-between;">
    <div style="max-width:58%;">
      <h2>Localiza√ß√£o do Templo</h2>
      <p>Gama ‚Äî Bras√≠lia, DF</p>
      <p style="font-size:11px;color:#6a534d">Abra no Google Maps escaneando o QR code ou clicando no link.</p>
      <p style="font-size:10px;color:#6a534d;word-wrap:break-word;">
        Link: <span id="pdfMapLink">https://www.google.com/maps/search/?api=1&query=Gama+Brasilia+DF</span>
      </p>
    </div>

    <!-- QR din√¢mico (ser√° gerado por JS) -->
    <div id="pdf-qr" aria-hidden="false"></div>
  </div>

  <div class="pdf-footer">
    <div>Deus Coco aben√ßoe a festa ü••</div>
    <div>Convite oficial ‚Äî Culto Coconista</div>
  </div>
</div>

<!-- bibliotecas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
  // Fun√ß√£o utilit√°ria para gerar QR no elemento #pdf-qr
  function gerarQRCodeEmElemento(url) {
    const el = document.getElementById('pdf-qr');
    el.innerHTML = ''; // limpar se j√° tiver
    // QRCode (qrcodejs) gera uma <img> ou <table> automaticamente
    new QRCode(el, {
      text: url,
      width: 110,
      height: 110,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });
  }

  // Gera PDF em UMA √∫nica p√°gina A4 (captura #pdfArea como imagem)
  async function gerarPDFA4_unica(nomeArquivo = 'convite-coconista.pdf') {
    // mapa (link) ‚Äî adapte se quiser coordenadas exatas
    const endereco = 'Gama, Bras√≠lia, DF';
    const mapUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(endereco);

    // atualizar link vis√≠vel no pdf e gerar QR
    document.getElementById('pdfMapLink').textContent = mapUrl;
    gerarQRCodeEmElemento(mapUrl);

    // pegamos o elemento que j√° tem tamanho A4 (em mm via CSS)
    const pdfArea = document.getElementById('pdfArea');

    // small delay para garantir QR renderizado
    await new Promise(r => setTimeout(r, 350));

    // usar html2canvas para gerar um canvas do A4; scale maior => melhor resolu√ß√£o
    const scale = 3; // aumenta qualidade (3 = bom). Ajuste se lento.
    const canvas = await html2canvas(pdfArea, {
      scale: scale,
      useCORS: true,
      allowTaint: true,
      logging: false
    });

    // transformar em imagem
    const imgData = canvas.toDataURL('image/jpeg', 1.0);

    // criar jsPDF e colocar a imagem como UMA p√°gina inteira (com margens)
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');

    const pageWidth = 210;
    const pageHeight = 297;
    const margin = 10; // mm

    // adiciona imagem cobrindo a √°rea central respeitando margens
    pdf.addImage(imgData, 'JPEG', margin, margin, pageWidth - margin * 2, pageHeight - margin * 2);
    pdf.save(nomeArquivo);
  }

  // Bot√µes
  document.getElementById('gerarBtn').addEventListener('click', function(){
    gerarPDFA4_unica('convite-coconista.pdf')
      .catch(err => { console.error(err); alert('Erro ao gerar PDF: ' + err.message); });
  });

  // exemplo de bot√£o simples que gera sem QR (apenas outra varia√ß√£o)
  document.getElementById('baixarSimples').addEventListener('click', function(){
    gerarPDFA4_unica('convite-coconista-simples.pdf');
  });
</script>

<section id="confirmacao" style="max-width:600px; margin: 30px auto; padding:20px; background:#ffe4e1; border-radius:10px;">
  <h2>Confirme sua presen√ßa</h2>
  <form id="formConfirmacao">
    <label for="nome">Nome:</label><br>
    <input type="text" id="nome" name="nome" required style="width:100%; padding:8px; margin-bottom:10px;"><br>

    <label for="email">E-mail:</label><br>
    <input type="email" id="email" name="email" required style="width:100%; padding:8px; margin-bottom:10px;"><br>

    <label for="acompanhante">Vai levar acompanhante?</label><br>
    <select id="acompanhante" name="acompanhante" required style="width:100%; padding:8px; margin-bottom:10px;">
      <option value="N√£o">N√£o</option>
      <option value="Sim">Sim</option>
    </select><br>

    <button type="submit" style="background:#ff69b4; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">Confirmar Presen√ßa</button>
  </form>
</section>

<script>
  const form = document.getElementById("formConfirmacao");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const acompanhante = document.getElementById("acompanhante").value;

    if (!nome || !email) {
      alert("Por favor, preencha nome e email.");
      return;
    }

    try {
      const response = await fetch("https://convite-server.onrender.com/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ nome, email, acompanhante })
      });

      if (!response.ok) {
        throw new Error("Erro ao enviar confirma√ß√£o");
      }

      const data = await response.json();
      alert(data.message || "Confirma√ß√£o enviada com sucesso!");
      form.reset();

    } catch (error) {
      alert("N√£o foi poss√≠vel enviar a confirma√ß√£o. Tente novamente mais tarde.");
      console.error(error);
    }
  });
</script>
  
</body>

</html>
